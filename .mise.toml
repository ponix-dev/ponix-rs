[tools]
github-cli = "latest"
tilt = "latest"
rust = "latest"
grpcurl = "latest"
jq = "latest"
# Cross-platform tool installs
"github:pressly/goose" = "latest"
"github:nats-io/natscli" = "latest"

[tools."github:emqx/MQTTX"]
version = "latest"

[tools."github:emqx/MQTTX".platforms]
linux-x64 = { asset_pattern = "mqttx-cli-linux-x64" }
macos-arm64 = { asset_pattern = "mqttx-cli-macos-arm64" }
macos-x64 = { asset_pattern = "mqttx-cli-macos-x64" }

# all envs should be set in a .env file
[env]
_.file = '.env'


# Test tasks - run from workspace root
[tasks.test]
description = "Run all unit tests (fast, no external dependencies)"
run = "cargo test --workspace"

[tasks."test:unit"]
description = "Run unit tests only (excludes integration tests)"
run = "cargo test --workspace --lib --bins"

[tasks."test:integration"]
description = "Run integration tests (requires Docker for testcontainers)"
run = "cargo test --workspace --features integration-tests -- --test-threads=1"

[tasks."test:all"]
description = "Run all tests including integration tests"
run = "cargo test --workspace --features integration-tests"

[tasks."test:watch"]
description = "Watch and run unit tests on file changes"
run = "cargo watch -x 'test --workspace --lib --bins'"

[tasks."test:integration:watch"]
description = "Watch and run integration tests on file changes"
run = "cargo watch -x 'test --workspace --features integration-tests -- --test-threads=1'"

[tasks."test:e2e"]
description = "Run end-to-end tests (requires running service)"
run = "./scripts/test-all.sh"
